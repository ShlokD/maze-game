"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var _default=function(){function i(e,t){_classCallCheck(this,i),this.score=e,this.available=t}return _createClass(i,[{key:"setScore",value:function(e){this.score=e}},{key:"setAvailable",value:function(e){this.available=e}},{key:"getScore",value:function(){return this.score}},{key:"getAvailable",value:function(){return this.available}},{key:"incrementScore",value:function(){this.score++}}]),i}(),_default$1=function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,i),this.x=e,this.y=t}return _createClass(i,[{key:"getXY",value:function(){return{x:this.x,y:this.y}}},{key:"move",value:function(e,t){this.x+=e,this.y+=t}},{key:"toString",value:function(){return"(".concat(this.x,",").concat(this.y,")")}}]),i}(),_default$2=function(){function e(){_classCallCheck(this,e),this.piece=null,this.score=null,this.layout=[[],[],[],[],[],[],[]],this.seen={},this.positionMap={left:{x:-1,y:0},up:{x:0,y:-1},right:{x:1,y:0},down:{x:0,y:1}}}return _createClass(e,[{key:"setSeen",value:function(){var e=this.piece.toString();this.seen[e]=!0}},{key:"setScore",value:function(){var e=this.piece.toString();this.seen[e]||this.score.incrementScore()}},{key:"getScore",value:function(){return this.score.getScore()}},{key:"getAvailableScore",value:function(){return this.score.getAvailable()}},{key:"getPiecePosition",value:function(){return this.piece.getXY()}},{key:"getLayout",value:function(){return this.layout}},{key:"initLayout",value:function(){for(var e=0,t=0;t<this.layout.length;++t)for(var i=this.layout[t],n=0;n<this.layout.length;++n){var s=Math.round(Math.random());i.push(s),1===s&&e++}1===this.layout[3][3]?e--:this.layout[3][3]=1,this.piece=new _default$1(3,3),this.score=new _default(0,e),this.setSeen()}},{key:"isSpace",value:function(e,t){var i=!1;try{i=!!this.layout[t][e]}catch(e){}return i}},{key:"isMovable",value:function(e,t){var i=this.piece.getXY(),n=i.x+e,s=i.y+t;return 0<=n&&n<this.layout.length&&0<=s&&s<this.layout[0].length&&this.isSpace(n,s)}},{key:"movePiece",value:function(e){var t=this.positionMap[e];if(t){var i=t.x,n=t.y;return!!this.isMovable(i,n)&&(this.piece.move(i,n),this.setScore(),this.setSeen(),!0)}return!1}}]),e}(),coords={37:{direction:"left",ui:{x:-30,y:0}},38:{direction:"up",ui:{x:0,y:-30}},39:{direction:"right",ui:{x:30,y:0}},40:{direction:"down",ui:{x:0,y:30}}},_default$3=function(){function e(){_classCallCheck(this,e),this.pieceEl=document.querySelector("#piece"),this.scoreEl=document.querySelector("#score"),this.availableEl=document.querySelector("#available"),this.buttons=document.querySelectorAll(".controls button"),this.board=new _default$2,this.currentPosition={posX:0,posY:0},this.handleKeyPress=this.handleKeyPress.bind(this),this.handleButtonClick=this.handleButtonClick.bind(this)}return _createClass(e,[{key:"setScoreText",value:function(){this.scoreEl.textContent=this.board.getScore()}},{key:"setAvailableText",value:function(){this.availableEl.textContent=this.board.getAvailableScore()}},{key:"setPiece",value:function(e){var t=e.x,i=e.y;this.currentPosition.posX+=t,this.currentPosition.posY+=i,this.pieceEl.style.transform="translate(".concat(this.currentPosition.posX,"px, ").concat(this.currentPosition.posY,"px)")}},{key:"setUI",value:function(e){if(!coords[e])return!1;var t=coords[e],i=t.direction,n=t.ui;this.board.movePiece(i)&&(this.setPiece(n),this.setScoreText())}},{key:"handleKeyPress",value:function(e){e.preventDefault();var t=e.keyCode;this.setUI(t)}},{key:"handleButtonClick",value:function(e){var t=e.target.dataset.direction;this.setUI(t)}},{key:"start",value:function(){var t=this;this.board.initLayout(),this.setScoreText(),this.setAvailableText(),document.addEventListener("keydown",this.handleKeyPress),this.buttons.forEach(function(e){e.addEventListener("click",t.handleButtonClick)})}}]),e}();window.addEventListener("load",function(){"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js"),(new _default$3).start()});
